<!DOCTYPE html>
<html>
<head>
    <title>Search_Page</title>
    <meta charset="UTF-8">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name ="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/styleforsearch.css"> 
</head>
<script>
    $(document).on('click', '.searchButton', function () {
    $.ajax({
        type: 'POST',
        url: 'http://localhost:8888/Search',
        dataType: 'json',
        data: {
            search: $(search_song).val(),
            action: 'post'
        },
        success: function (json) {
            console.log(json)
            document.getElementById('results').style.display = 'inline';
            output = `<thead>
                        <tr>
                            <th style="background-color:#5d6475;" >Title</th>
                            <th style="background-color:#5d6475;" >Brand</th>
                            <th style="background-color:#5d6475;" >Solo Musician</th>
                            <th style="background-color:#5d6475;" >Type</th>
                            <th style="background-color:#5d6475;" >Produced Date</th>
                        </tr>
                    </thead><br>`;
                    console.log(json.length)
            if(json.length > 0){
                $.each(json, function( index, value ) {
                    console.log(value)
                    output += `<tbody>
                        <tr class='clickable-row' value= "${value.song_name}">
                            <td id = "sname" style="background-color:#707070;">`
                            +value.song_name+
                            `</td>
                            <td id = "sbrand" style="background-color:#707070;">`
                            +value.song_brand+
                            `</td>
                            <td id = "song_solo_musician" style="background-color:#707070;">`
                            +value.song_solo_musician+
                            `</td>
                            <td id = "type" style="background-color:#707070;">`
                                +value.song_type_song+
                                `</td>
                            <td id = "sprodate" type= "date" style="background-color:#707070;">`
                                +value.song_produced_date+
                                `</td>
                        </tr>
                    </tbody><br>`
            }) 
            }else{
                output +=`<p id = "not-found">Not Found</p>`
            }

            console.log(output)
            document.getElementById('results').innerHTML = output;
        },
        error: function (data) {
            alert(data.responseJSON.error);
        }
    });
});  
$(document).on('click', '.clickable-row', function (e) {
var name = $(e.target).closest('tr').find("td:eq(0)").html();
var brand = $(e.target).closest('tr').find("td:eq(1)").html();
var solo_musician = $(e.target).closest('tr').find("td:eq(2)").html();
var type = $(e.target).closest('tr').find("td:eq(3)").html();
var date = $(e.target).closest('tr').find("td:eq(4)").html();
console.log(name +" "+ brand)
$.ajax({
    type: 'POST',
    url: 'http://localhost:8888/Search',
    dataType: 'json',
    data: {
        name: $(name).val(),
        brand: $(brand).val(),
        solo_musician: $(solo_musician).val(),
        type: $(type).val(),
        date: $(date).val(),
        action: 'post'
    },
    success: function (json) {
        alert(name)
        fetch("http://localhost:8888/Result",{
            method: "POST",
            headers:{
                'Content-Type':'application/json'
            },
            body: JSON.stringify({
                name : name,
                brand : brand,
                solo_musician : solo_musician,
                type:type,
                date:date
            })
        })
        .then(response => response.json())
        .then(data => SetResult(data));
        if(brand != 'null'){
            document.location.href = '/Result?'+name+"?"+brand;
        }else{

        }
    },
    error: function (data) {
        alert("error");
    }
});
});
</script>
<body>
<header class ="header">
        <a href="/Home"><img src="../images/Logo_DriveSound-01.png" width="100px%"></a>
    <nav class ="nav">
        <a href="/Search">Search</a>
        <a href="/About_Us">About Us</a>
        <a href="/Account">Account</a>
    </nav>
</header>
<div class="headline">
    <p>Search Box Music</p>
</div>
    <div class="container">
            <div class="searchBox">
                <input class="searchInput" id="search_song" type="search" name="search" placeholder="Search Music" required>
                <button class="searchButton" id="btn" type ="submit" value="Submit">
                   <i class="click" id="c" > 
                        Search 
                    </i>
                </button>
            </div>
    </div>
    <div class ="container2">
        <form id ="output" method = "get" >
            <table style = "display: none" id = "results" class="table table-hover table-dark" >
            </table>
        </form>
    </div>

</body>

<br>
<br>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.4.4/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>

<script src="../search_function.js"></script>
<script src = "../public/js/search.js"></script>



</html>
