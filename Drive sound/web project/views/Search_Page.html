<!DOCTYPE html>
<html lang="en">
<head>
    <title>Search_Page</title>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="css/styleforsearch.css"> 
</head>
<script>
    var obj;
    $(document).on('click', '.searchButton', function () {
    $.ajax({
        type: 'POST',
        url: 'http://localhost:8888/Search',
        dataType: 'json',
        data: {
            search: $(search_song).val(),
            action: 'post'
        },
        success: function (json) {
            
            console.log(json)
            document.getElementById('results').style.display = 'inline';
            output = `<thead>
                        <tr>
                            <th>Title</th>
                            <th>Brand</th>
                            <th>Solo Musician</th>
                            <th>Type</th>
                            <th>Produced Date</th>
                        </tr>
                    </thead><br>`;
                    console.log(json.length)
            if(json.length > 0){
                $.each(json, function( index, value ) {

                    if(value.song_brand == null){
                        value.song_brand = '-';
                    }
                    if(value.song_solo_musician == null){
                        value.song_solo_musician = '-';
                    }
                    let pdate = value.song_produced_date.split("T")[0];
                    console.log(value.song_solo_musician)
                    output += `<tbody>
                        <tr class='clickable-row'>
                            <td id = "sname">`
                            +value.song_name+
                            `</td>
                            <td id = "sbrand">`
                            +value.song_brand+
                            `</td>
                            <td id = "song_solo_musician">`
                            +value.song_solo_musician+
                            `</td>
                            <td id = "type">`
                                +value.song_type_song+
                                `</td>
                            <td id = "sprodate" type= "date">`
                                +pdate+
                                `</td>
                        </tr>
                    </tbody><br>`
                    
            }) 
            }else{
                output +=`<p id = "not-found">Not Found</p>`
            }
            document.getElementById('results').innerHTML = output;
        },
        error: function (data) {
            alert('data.responseJSON.error');
        }
    });
});  
$(document).on('click', '.clickable-row', function (e) {
var name = $(e.target).closest('tr').find("td:eq(0)").html();
var brand = $(e.target).closest('tr').find("td:eq(1)").html();
var solo_musician = $(e.target).closest('tr').find("td:eq(2)").html();
var type = $(e.target).closest('tr').find("td:eq(3)").html();
var date = $(e.target).closest('tr').find("td:eq(4)").html().split("T")[0];
$.ajax({
    type: 'POST',
    url: 'http://localhost:8888/Search',
    dataType: 'json',
    data: {
        name: $(name).val(),
        brand: $(brand).val(),
        solo_musician: $(solo_musician).val(),
        type: $(type).val(),
        date: $(date).val(),
        action: 'post'
    },
    success: function (json) {
        alert(name)
        fetch("http://localhost:8888/Result",{
            method: "POST",
            headers:{
                'Content-Type':'application/json'
            },
            body: JSON.stringify({
                name : name,
                brand : brand,
                solo_musician : solo_musician,
                type:type,
                date:date
            })
        })
        .then(response => response.json())
        .then(data => SetResult(data));

        document.location.href = '/Result?'+name+"?"+brand+"?"+solo_musician;
        
    },
    error: function (data) {
        alert("error");
    }
});
});
</script>
<body>
<header class ="header">
        <a href="/Home"><img src="../images/Logo_DriveSound-01.png" width="100px%"></a>
    <nav class ="nav">
        <a href="/Search">Search</a>
        <a href="/About_Us">About Us</a>
        <a href="/Account">Account</a>
        <a href="/logout">Logout</a>
    </nav>
</header>
<div class="headline">
    <p>Search Box Music</p>
</div>
    <div class="container">
            <div class="searchBox">
                
              
                <input class="searchInput" id="search_song" type="search" name="search" placeholder="Search Music" required>
                <button class="searchButton" id="btn" type ="submit" value="Submit">
                   <i class="click" id="c" > 
                        Search 
                    </i>
                </button>

               
                
                   
                </div>

            </div>
    </div>
    <div class ="container2">
        <form id ="output" method = "get" >
            <table style = "display: none" id = "results" class="table table-hover table-dark" >
            </table>
        </form>
    </div>

</body>

<br>
<br>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.4.4/umd/popper.min.js"></script>




</html>
